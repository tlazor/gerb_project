I'm wondering because I was thinking about using this technique to circumvent a block between peers in a network (like a school network where clients can only access the internet, but any contact with each other is blocked). The only other option is to use a man in the middle as proxy (tunnel?). The disadvantage of this is that you have to have a server with significantly more bandwidth than one that would only do hole punching. Also the latency would increase significantly.
So if the source computer is on IP address 10.1.1.5 with a mask of 255.255.255.0 and the destination address is 10.1.1.50, the NAT router will ignore it, only the switch(s) will handle it.
If the destination were 10.2.1.50 then you would need a router but, depending on the routers configuration, it is likely that the route would still not hit the NAT part since you wouldn't normally NAT on an internal network. NAT adds overheads and issues that you wouldn't want and you should never need NAT internally.
What happens when using hole punching on the same network, is that it will send a packet out with the same destination and source address. Only the source and destination port would differ. I imagine a router with NAT loopback enabled will handle this as it should, but how about other routers? Would they drop the packet, or would a router (the first?) from the ISP bounce the packet back after which it gets handled okay?
That's called NAT Hairpinning. A NAT that support Hairpinning can do translation even if both peers are in the same NAT.
I was wondering if tcp/udp hole punching would still work when you are in the same network (behind a NAT), and what the packet's path would be.
Indeed, if peer-to-peer traffic is being blocked, this is probably happening with a transparent filter of some sort.
The only way around this is to find a channel that does work between the peers and then run an encrypted channel over this.
Finally, since the peer-to-peer connections are being blocked, trying to circumvent the block WILL be a contravention of your terms of service - you will be kicked off the network, possibly be expelled (from school) or even face criminal prosecution - really not worth it! Set up your own WiFi network instead for peer-to-peer traffic.