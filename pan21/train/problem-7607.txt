DrawTiles calls the draw function on all the tiles within the bounds rectangle.  They are all in a large 2048x2048 sprite sheet.  Map is broken up into blocks of these which the transform matrix is used to offset.
This all works in XNA 3.1.  I stripped the pixel shader to absolutely nothing, just outputs white (or is supposed to).  Im sure its not any of the specific drawing code because like I said if I switch to the default SpriteBatch vertex shader (IE not defining one, and rolling the PS back to 2.0). Then it works as expected.  It draws white pixels everywhere it should.
There must be something wrong im doing with the matrix / viewport manipulations, but am not sure what.  Ive looked at SpriteBatches default shader, but it uses a lot of macros and sets the matrix up before going to the shader and not sure how to correlate it with mine.
In XNA 3.1 everything works fine with my custom vertex and pixel shaders targeting SM 3.0.  I cant find any info on what has changed or why its not working.  Ive stripped it down as far as I can to try to figure it out, but am not sure.  It definitely seems like a coordinate issue with the vertex shader.  If I strip our the vertex shader and switch to SM 2.0 for the pixel shader so it uses XNAs default vertex shader for SpriteBatch, it works as expected, but I need 3.0 and custom vertex shader functionality.
I believe ive solved this immediate issues, though now I have other unrelated ones lol.  I dont know why this is, but this fixed it.  Before I could not get any output whatsover, all blank/transparent.  But just changing this fixed most of it:
Maybe it was a quirk in XNA 3.1 where the input texture coordinates wasnt in the 0-1 range?  Bleh, I dunno.
I have recently been converting our XNA 3.1 game to XNA 4.0 and am stuck on the shaders.  I have the game running, but nothing is drawing to the screen, except things not using a shader.