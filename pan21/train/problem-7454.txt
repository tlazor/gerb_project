Without line of site I'd imagine its going to be quite difficult to work out which antenna is best - but definately not an Omni.   If you are creative, you may be able to get some MIMO gear and multiple antennas - That might give you better performance because it is designed to handle multiple paths better.  Never done this though.
Typically the lower the frequency the less Line Of Site matters and the further the distance (but the less bandwidth you have).  From that point of view, 2.4 gig is better then 5 gig band - of-course 2.4 is a lot noisier because of interference.
802.11n is a better option then 802.11g for your application.   Getting directional antennas would make a difference.   
300 Meters without line of site is an ask, I suspect it might be marginally possible, but not practical.   I've not played with it, but I suspect you will get substantially better performance if you can find some 900 MHz equipment - although it looks like the bandwidth available on it is not that great - from some googling probably 2-4 Megabit throughput - and it looks quite expensive.
Have you been on your roof to see what is visible from there - you may be surprised by how much you can see  In the same vain, can you mount the Aerial on a pole to get more clearance ?