Then I read your article and decided to reapply the flag and try a reboot, but funnily the used disk space didn't increase this time.
Having recently researched a similar problem, I can also say that a compressed file takes at least 4 kilobytes of space per file, and a temporary space of 64 kilobytes, which is the size of one "Compression Unit" for NTFS with 4kb cluster size. The article on blogs.msdn.com also mentions that when the file is compressed, the disk space is allocated to hold one full CU, and is released at undetermined time. This should be the reason of why you are experiencing the loss of 5GB, albeit temporary (a reboot should definitely fix that loss, some other means should do that too, but not defrag - have tried and failed). Apparently what's allocated seems to be a lot bigger (64kb*(31048+582) = 2072903680 or 1.93 GB), but this is explainable as NTFS has transactions which take time and processor units to be committed into raw data, and when that process will be finished, you will get all 5GB plus 150 MB space released due to compression back.
I guess there could be an issue in Windows Server 2016 (maybe since ever) that internally generated temporary files are not cleaned up properly when files are copied to a compressed folder (as opposed to when the compression flag is applied to already existing files).
Server migration, I copied the data folders of a drive of the old Windows Server 2012R2 (with 2 compressed folders) on a newer Windows Server 2016 Datacenter drive of the same size where I created the folder structure and set the compressed flags on these two folders previously to the copy process. During copying I run out of diskspace, and anywhere I looked only 3GB of 20GB are used, but the drive itself tells me 19.x GB are used. A colleague told me to remove the compression flag, and miraculously the lost 17GB reappear.
I repeated the compress/decompress cylce three times to make sure another program did not coincidentally take up the disk space. It might be notable that the folder contains a large number of small files (â‰ˆ 30k).
To save some disk space I figured it might be a good idea to compress the VMware vSphere Client I have installed because I almost never use it.
I was surprised to find that it had the exact opposite effect on free disk space. I tracked it down further and found that it is related to compressing the Help folder. The loss of disk space is not reflected in the folder size.
To summarize, you only lose space temporarily if you compress a whole lot of files. But, if those files are frequently modified, your disk space gets allocated to hold uncompressed data for those files in case their altered content won't be able to be compressed to fit in whatever space that cluster had occupied prior to write action. 